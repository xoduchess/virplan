<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Virtual Planner</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="cal.css">
    </head>
    <body>
        <!--<div id='parent'>-->
    <!--Add Task area-->
    <textarea id="taskbox" draggable ="true" ondragstart="drag(event)" > What's your Task? </textarea>

<!-- 
  <div class="popup" onclick="myFunction()">
  <span class="popuptext" id="myPopup">Popup text...</span>
  </div> -->



  <div id="popup_main"> <!-- main content frame -->
     <div id= "popup_select"> <!-- frame (main body) for selection of colors-->
       <p>
          What is the category of this task?
          <br>
          <br>
          <button id="button1" >Deadline</button>
          <br>
          <br>
          <button id="button2" >Meeting</button>
          <br>
          <br>
          <button id="button3">Study Time</button>
       </p>
     </div>
     <div id ="close_popup" onclick="closePopUp()">
       <p>
          Close
       <p>
     </div>
  </div>

  <!-- <div class="popup" onclick="myFunction()">here
  <span class="popuptext" id="taskbox">Popup text...</span>
  </div> -->


    <!--* added from Pinch&ColorSwitch branch (index.html)-->
    <script src="https://cdn.rawgit.com/hammerjs/touchemulator/master/touch-emulator.js"></script>
    <script> TouchEmulator(); </script>
    <script src="https://hammerjs.github.io/dist/hammer.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://cdn.rawgit.com/julianshapiro/velocity/master/velocity.min.js"></script>
    <!-- end -->

    <!-- code for functionality -->
    <script>

       //* create variable that gets an element by id 
       taskbox = document.getElementById("taskbox");
        var pressTask;

       //looks for the element with this id 
       $taskbox = jQuery(taskbox); //* *added from Pinch&ColorSwitch branch (index.js) 

      ///* added from Pinch&ColorSwitch branch (index.js)
       // create a manager for that element
       var originalManager = new Hammer.Manager(taskbox);

       // create recognizers
       var Pan = new Hammer.Pan(); 
       var Pinch = new Hammer.Pinch();

       var Tap = new Hammer.Tap({
       taps: 1
       });

       var DoubleTap = new Hammer.Tap({
          event: 'doubletap',
          taps: 2
       });


        // use them together
        DoubleTap.recognizeWith([Tap]);
        Tap.requireFailure([DoubleTap]);

       // add the recognizer 
       originalManager.add(Pan);
       originalManager.add(Pinch);

       originalManager.add(DoubleTap);
       originalManager.add(Tap);
     


originalManager.on('doubletap', function(e) {
  //tapTask = e.target;
  console.log('doubletapped');
  myFunction(e);

  // var scale = $.Velocity.hook($stage, 'scale');
  // if (isShrunken) {
  //   $.Velocity.hook($stage, 'scale', 2 * scale);
  // } else {
  //   $.Velocity.hook($stage, 'scale', .5 * scale);
  // }
  // isShrunken = !isShrunken;
 
  //*changed code to double tap to change the color*    


  //   currentColorIndex++;
  // if (currentColorIndex >= colors.length) {
  //   currentColorIndex = 0;
  // }
  // stage.style.backgroundColor = makeColor(colors[currentColorIndex]);
  // stage.style.borderColor = makeColor(colors[currentColorIndex], 0.85);




});
//EDIT
       
       // subscribe to events
       var currentScale = 1;
       function getRelativeScale(scale) {
         return scale * currentScale;
       }
       originalManager.on('pinchmove', function(e) {
          pinchAction(e);
          
        //  //$.Velocity.hook($stage, 'scale', scale);
       });
       originalManager.on('pinchend', function(e) {
          // cache the scale
          currentScale = getRelativeScale(e.scale);
        });

//EDIT
      // axis
       var deltaX = 0;
       var deltaY = 0;

       //** when starting to pan
       originalManager.on('panstart',function(e){
        //** add 'dragging-task' to the triggered element's class list
          e.target.classList.add('dragging-task');
            
       })

       //when panning (moving) element
       originalManager.on('panmove', function(e) {
        
        var dX = deltaX + (e.deltaX);
        var dY = deltaY + (e.deltaY);
        $.Velocity.hook($taskbox, 'translateX', dX + 'px');
        
        //** selects element immediately below the cursor by raising textbox 30 px above it
        $.Velocity.hook($taskbox, 'translateY', dY - 30 + 'px');
      
       });

       //when panning ends
       originalManager.on('panend', function(e) {
       deltaX = deltaX + e.deltaX;
       deltaY = deltaY + e.deltaY;
     //end of add from branch */


       //** variable to get element right behind cursor //
       selected = document.elementFromPoint(e.center.x, e.center.y); //should be one of the day blocks in the calendar
       
       //** add copy of the element to the calendar
       var copied = e.target.cloneNode(); //puts copy of the element into variable
       createHammerManager(copied);
       copied.classList.add('acquired-task'); //adds class to classList so copy has same width 

       //** CSS transform property 
       copied.style.transform = "none"; 
       e.target.style.transform = "none";

       //place element on the calendar
       selected.appendChild(copied);
       //resets axis' coordinates 
       deltaX = 0; //start from zero again
       deltaY = 0;

      });

// //EDIT
       
//        // subscribe to events
//        var currentScale = 1;
//        function getRelativeScale(scale) {
//          return scale * currentScale;
//        }
//        manager.on('pinchmove', function(copied) {

//         // do something cool
//         var scale = getRelativeScale(copied.scale);
//         // console.log(scale);
//         var task = copied.target; //the thing doing event to 
//         var textSize = parseFloat(window.getComputedStyle(taskbox)["font-size"]); //parses font size to find the size
//         console.log(textSize);
//         var newSize = textSize*scale;
          
//         //  //$.Velocity.hook($stage, 'scale', scale);
//        });
//        manager.on('pinchend', function(copied) {
//           // cache the scale
//           currentScale = getRelativeScale(e.scale);
//         });

// //EDIT
//



function createHammerManagerForDays(day) {
  console.log(day);
  var dayManager = new Hammer.Manager(day);
  dayManager.add(new Hammer.Tap());

  dayManager.on('tap', function(e) {
    console.log(e.target);

    if(e.target.classList.contains('acquired-task')) {

    } else {
      e.target.appendChild(pressTask.cloneNode());

    }
  })
}

        function createHammerManager(copied) 
        {
            // create a manager for that element
            var manager = new Hammer.Manager(copied);

        //     var oneTap = new Hammer.Tap({
        //          taps: 1
        //     });

            var twoTap = new Hammer.Tap({
              event: 'doubletap',
              taps: 2
             });


        //       // use them together
        // twoTap.recognizeWith([oneTap]);
        // oneTap.requireFailure([twoTap]);


             // add the recognizer 
            manager.add(new Hammer.Pinch());
            manager.add(new Hammer.Pan());
            manager.add(new Hammer.Press());
            // manager.add(oneTap);
            // manager.add(twoTap);
            manager.add(twoTap);

        manager.on('doubletap', function(e) {
          //tapTask = e.target;
          console.log('doubletapped');
          myFunction(e);

        });
      
       // subscribe to events
       var currentScale = 1;
       
       function getRelativeScale(scale) {
         return scale * currentScale;
       }
       manager.on('pinchmove', function(e) {
        pinchAction(e);
          
        //  //$.Velocity.hook($stage, 'scale', scale);
       });

       manager.on('pinchend', function(e) {
          // cache the scale
          currentScale = getRelativeScale(e.scale);
        });

       manager.on('press', function(e) {
        console.log("press");
        pressTask = e.target;
       });



       // manager.on('pressup', function(e) {
       //  pressTask = e.target;
       // });


       var deltaX = 0;
       //var deltaY = 0;

       var panCanvas, panTargetBox; 

       //** when starting to pan
       manager.on('panstart',function(e){
        //** add 'dragging-task' to the triggered element's class list
          e.target.classList.add('dragging-task');
          
          var canvas = document.createElement("canvas");
          panCanvas = canvas.getContext('2d');
          var targetBox = e.target.getBoundingClientRect();
          panTargetBox = targetBox;
          canvas.classList.add('task-canvas');
          canvas.style.width = targetBox.width + "px";
          canvas.style.height = targetBox.height + "px";
          canvas.style.left = targetBox.left + "px";
          canvas.style.top = targetBox.top + "px";


          //canvas.width = e.target.style.width; 
          //console.log(e.target.style.width);
          //canvas.height = e.target.style.height; 
          e.target.parentNode.appendChild(canvas); //gets parent of the element  


       })

       //when panning (moving) element
       manager.on('panmove', function(e) {
        
        var dX = deltaX + (e.deltaX);
        var dY = deltaY + (e.deltaY);

        //$.Velocity.hook($taskbox, 'translateX', dX + 'px');
        
        //** selects element immediately below the cursor by raising textbox 30 px above it
        //$.Velocity.hook($taskbox, 'translateY', dY - 30 + 'px');
        //console.log(e);
        drawDot(panCanvas, e.center.x - panTargetBox.left, e.center.y - panTargetBox.top);

        if(dX > panTargetBox.width) {
          panCanvas.canvas.remove();
          e.target.remove();
        }
       });

       //when panning ends
       manager.on('panend', function(e) {
       deltaX = deltaX + e.deltaX;
       panCanvas.canvas.remove();
       //deltaY = deltaY + e.deltaY;
      });


      // Draws a dot at a specific position on the supplied canvas name
    // Parameters are: A canvas context, the x position, the y position
      function drawDot(ctx,x,y) {
        // Let's use black by setting RGB values to 0, and 255 alpha (completely opaque)
        r=255; g=0; b=0; a=255;

        // Select a fill style
        ctx.fillStyle = "rgba("+r+","+g+","+b+","+(a/255)+")";
        // Draw a filled circle
        ctx.beginPath();
        ctx.arc(x, y, 10, 0, Math.PI*2, true);
        ctx.closePath();
        ctx.fill();
      }


// manager.on('tap', function(e) {
//   // currentColorIndex++;
//   // if (currentColorIndex >= colors.length) {
//   //   currentColorIndex = 0;
//   // }
//   // stage.style.backgroundColor = makeColor(colors[currentColorIndex]);
//   // stage.style.borderColor = makeColor(colors[currentColorIndex], 0.85);
// });


   }
//
//

        var maxSize = 20; 
//function to call for pinch and zoom for each element  
        
        function pinchAction(e)
        {
           // do something cool
        var scale = getRelativeScale(e.scale);
        // console.log(scale);
        var task = e.target; //the thing doing event to 
        var textSize = parseFloat(window.getComputedStyle(taskbox)["font-size"]); //parses font size to find the size
        //console.log(textSize);

        var newSize = scale*textSize; 

        if (newSize > maxSize)
        {

        }
        else
          {
          task.style.fontSize = newSize + "px";
          //console.log(newSize);
          }
      

        }





//------

        //Allow elements to be dropped
        function allowDrop(task){ 
            task.preventDefault();

            //** allows element to be copied before dragged
            task.effectAllowed =  "copyMove"; 
          }

        //What data should be dragged (Start dragging at taskbox)
        function drag(task){

            //** added class for dragging  
            task.target.classList.add('dragging-task');
              //task.dataTransfer.setData("text", task.target.id);
              //dataTransfer sets data type and value of task being dragged

            //** copied object will be dragged instead of dragging the original 
            task.dataTransfer.dropEffect = "copy"; 
          }

        //Repeat for Drop- Data can't be dropped in other elements(By Default)
        function drop(task){
            task.preventDefault(); 
            var taskdata = task.dataTransfer.getData("text"); 

              //*added cloneNode to clone the box instead so the box could be copied 
              //*created a new variable where the cloned node is placed
              //var newTask = document.getElementById(taskdata).cloneNode();


            //** get the first element in the class list and clone it 
            var newTask = document.getElementsByClassName('dragging-task')[0].cloneNode(); //clones the element being dragged
            //** remove dragging from class list since it's no longer needed 
            newTask.classList.remove("dragging-task");

            //** created new class so we can manipulate the copied object
            newTask.classList.add("acquired-task");
            newTask.removeAttribute("id");

            //** moves task into the calendar
            task.target.appendChild(newTask);
            
            //** drops the copied element and keeps original in place
            task.dataTransfer.dropEffect = "copy"; 

          }


var button1, button2, button3;
button1 = document.getElementById("button1");
button2 = document.getElementById("button2");
button3 = document.getElementById("button3");

    
      button1.addEventListener("click", function()
      {
          //var popup = document.getElementById('myPopup');
          //popup.classList.toggle('show');
          targetElement.style.backgroundColor = "green";
      });

        button2.addEventListener("click", function()
      {
          //var popup = document.getElementById('myPopup');
          //popup.classList.toggle('show');
          targetElement.style.backgroundColor = "blue";
      });


    button3.addEventListener("click", function()
      {
          //var popup = document.getElementById('myPopup');
          //popup.classList.toggle('show');
          targetElement.style.backgroundColor = "yellow";
      });

var popup = document.getElementById("popup_main");
//  // When the user clicks on div, open the popup
function myFunction(e) {
    targetElement = e.target;
    // button1.addEventListener("click", function()
    //   {
    //       //var popup = document.getElementById('myPopup');
    //       //popup.classList.toggle('show');
    //       target.style.backgroundColor = "green";
    //   });

    // button2.addEventListener("click", function()
    //   {
    //       //var popup = document.getElementById('myPopup');
    //       //popup.classList.toggle('show');
    //       target.style.backgroundColor = "blue";
    //   });


    // button3.addEventListener("click", function()
    //   {
    //       //var popup = document.getElementById('myPopup');
    //       //popup.classList.toggle('show');
    //       target.style.backgroundColor = "yellow";
    //   });

    popup.style.display = "block";
}



function closePopUp()
{
    popup.style.display = "none";

}



// function changeColor_B1()
// {
//     taskbox.style.backgroundColor = "orange";
// } 

// function changeColor_B2()
// {
//     taskbox.style.backgroundColor = "yellow";
// } 

// function changeColor_B3()
// {
//     taskbox.style.backgroundColor = "green";
// } 


  // else 
  //   if (document.getElementById("button3"))
  //   {
  //     taskbox.style.backgroundColor = "orange";
  //   }

  //   button1.onClick = taskbox.style.backgroundColor = "red";
  //   button2.onClick = taskbox.style.backgroundColor = "blue";
  //   button3.onClick = taskbox.style.backgroundColor = "green";


//}


</script>


    </script>

    <!--<script type="text/javascript">
        document.addEventListener("click", createTask); 
            
         function createTask(){ 
             //create container
             var c = document.getElementById("parent");
             var taskbox = document.createElement("textarea"); 
             
             //taskbox.id = "MyTaskBox"; 
             c.appendChild(taskbox);
}
       
       // var taskbox = document.createElement('textarea');
        //document.addEventListener("click", createTask); 
            
    
        
       /* function CreateTask(){ 
            var taskbox = document.createElement('textarea'); 
            document.getElementById('textarea').addEventListener('click');
            taskbox.appendChild(taskbox);}*/
        
     </script>


</div>
        <button> Create Task </button>
        <!--<button onClick="CreateTask()">Create Task</button> --><br><br>
 <div id= "monthcdiv" ondrop="drop(event)" ondragover="allowDrop(event)">
        <!--Canvas Creation-->
        <div class="CalendarMonth"> 
  <ul>
    
    
    <li>
      ~ November 
      <span style="font-size:30px"> 2016 ~</span>
    </li>
  </ul>
</div>

<ul class="Weekdays">
  <li>Sunday</li>
  <li>Monday</li>
  <li>Tuesday</li>
  <li>Wednesday</li>
  <li>Thursday</li>
  <li>Friday</li>
  <li>Saturday</li>
  
</ul>

<ul class="Days"> 
    <li>30<br><br><br><br><br><br><br><br><br><br></li>
    <li>31<br><br><br><br><br><br><br><br><br><br></li>
  <li>1<br><br><br><br><br><br><br><br><br><br></li>
  <li>2<br><br><br><br><br><br><br><br><br><br></li>
  <li>3<br><br><br><br><br><br><br><br><br><br></li>
  <li>4<br><br><br><br><br><br><br><br><br><br></li>
  <li>5<br><br><br><br><br><br><br><br><br><br></li>
  <li>6<br><br><br><br><br><br><br><br><br><br></li>
  <li>7<br><br><br><br><br><br><br><br><br><br></li>
  <li>8<br><br><br><br><br><br><br><br><br><br></li>
  <li>9<br><br><br><br><br><br><br><br><br><br></li>
  <li>10<br><br><br><br><br><br><br><br><br><br></li>
  <li>11<br><br><br><br><br><br><br><br><br><br></li>
  <li>12<br><br><br><br><br><br><br><br><br><br></li>
  <li>13<br><br><br><br><br><br><br><br><br><br></li>
  <li>14<br><br><br><br><br><br><br><br><br><br></li>
  <li>15<br><br><br><br><br><br><br><br><br><br></li>
  <li>16<br><br><br><br><br><br><br><br><br><br></li>
  <li><br><br><br><br><br><br><br><br><br><span class="active">17</span></li>
  <li>18<br><br><br><br><br><br><br><br><br><br></li>
  <li>19<br><br><br><br><br><br><br><br><br><br></li>
  <li>20<br><br><br><br><br><br><br><br><br><br></li>
  <li>21<br><br><br><br><br><br><br><br><br><br></li>
  <li>22<br><br><br><br><br><br><br><br><br><br></li>
  <li>23<br><br><br><br><br><br><br><br><br><br></li>
  <li>24<br><br><br><br><br><br><br><br><br><br></li>
  <li>25<br><br><br><br><br><br><br><br><br><br></li>
  <li>26<br><br><br><br><br><br><br><br><br><br></li>
  <li>27<br><br><br><br><br><br><br><br><br><br></li>
  <li>28<br><br><br><br><br><br><br><br><br><br></li>
  <li>29<br><br><br><br><br><br><br><br><br><br></li>
  <li>30<br><br><br><br><br><br><br><br><br><br></li>
</ul>
    



    </div>
      

 



      <!--<canvas id= "theCanvas" width="1000" height="1000"> </canvas> -->
      <!-- <script type="text/javascript" language="javascript">
      <!--<button> Create Task </button>
   
      <div id= "parent">  
    </div>-->
   
   
    <!--<script>
      var canvas = document.getElementById('myCanvas');
      var context = canvas.getContext('2d');

      context.beginPath();
      context.moveTo(100, 150);
      context.lineTo(450, 50);
      context.stroke();
    </script>

    //Writing to Canvas
      /*
      var canvas = document.getElementById("theCanvas"); 
      var ctx = canvas.getContext("2d"); 
          ctx.moveTo(0,0); 
          ctx.lineTo(100,100);  
          ctx.stroke();
            
    </script> 
      <script type="text/javascript">
  
      var cal = new Calendar();
      cal.generateHTML();
      document.write(cal.getHTML());*/

    </script>-->
    <script type="text/javascript">
      //dayElements = $.find(".Days").find('li');
      dayElements = document.getElementsByTagName('li');
      console.log(dayElements);

    for (var i = 0; i < dayElements.length; i++) {
        createHammerManagerForDays(dayElements[i]);

    }
     
    // dayElements.forEach(function(element) {
    // createHammerManagerForDays(element);
    // });

    </script>
 
    </body>
</html>
